% ===================================
% PGFPLOTS STYLES FOR PUBLICATION-GRADE DIAGRAMS
% ===================================
% This file defines comprehensive PGFPlots styles for consistent,
% publication-quality plots throughout the book.

% --- Base style for all plots ---
\pgfplotsset{
    % Base style applied to all plots
    publication/.style={
        % Size and proportions
        width=0.85\textwidth,
        height=0.6\textwidth,
        scale only axis,
        % Font settings
        tick label style={font=\small},
        label style={font=\small},
        legend style={font=\footnotesize},
        title style={font=\small\bfseries},
        % Axis styling
        axis lines=left,
        line width=0.8pt,
        tick style={thin, black},
        grid=none,
        % Border styling
        axis line style={-},
        % Default sampling
        samples=100,
        % Legend styling
        legend cell align=left,
        legend style={
            draw=octonary!40,
            fill=white,
            rounded corners=2pt,
            line width=0.5pt
        },
        % Default positioning
        legend pos=north east,
    },
    % --- Grid variants ---
    publication grid/.style={
        publication,
        grid=both,
        grid style={octonary!20, very thin},
        minor grid style={octonary!10, very thin},
        minor tick num=1,
    },
    publication grid y/.style={
        publication,
        grid=y,
        grid style={octonary!20, very thin},
        minor grid style={octonary!10, very thin},
        minor tick num=1,
    },
    publication grid x/.style={
        publication,
        grid=x,
        grid style={octonary!20, very thin},
        minor grid style={octonary!10, very thin},
        minor tick num=1,
    },
    % --- Size variants ---
    publication small/.style={
        publication,
        width=0.65\textwidth,
        height=0.45\textwidth,
    },
    publication large/.style={
        publication,
        width=\textwidth,
        height=0.7\textwidth,
    },
    publication square/.style={
        publication,
        width=0.7\textwidth,
        height=0.7\textwidth,
    },
    % --- Special purpose styles ---
    survival plot/.style={
        publication,
        xlabel={Time},
        ylabel={Survival Probability},
        ymin=0,
        ymax=1,
        xmin=0,
        legend pos=south west,
    },
    hazard plot/.style={
        publication,
        xlabel={Time},
        ylabel={Hazard},
        ymin=0,
        xmin=0,
        legend pos=north east,
    },
    comparison plot/.style={
        publication grid,
        xlabel={Time},
        ylabel={Value},
        legend pos=north east,
    },
    confidence interval plot/.style={
        publication,
        xlabel={Time},
        ylabel={Estimate},
        legend pos=north east,
        grid=y,
        grid style={octonary!15, very thin},
    },
    cumulative incidence plot/.style={
        publication,
        xlabel={Time},
        ylabel={Cumulative Incidence},
        ymin=0,
        ymax=1,
        xmin=0,
        legend pos=north west,
    },
    training curve/.style={
        publication grid,
        xlabel={Epoch},
        ylabel={Loss},
        legend pos=north east,
    },
    calibration plot/.style={
        publication grid,
        xlabel={Predicted Probability},
        ylabel={Observed Frequency},
        xmin=0,
        xmax=1,
        ymin=0,
        ymax=1,
        legend pos=south east,
    },
    boxplot/.style={
        publication,
        boxplot/draw direction=y,
        cycle list name=conceptcolors,
    },
    heatmap/.style={
        publication,
        colorbar,
        colormap={custom}{color(0)=(white); color(1)=(primary)},
        colorbar style={
            title={\footnotesize Value},
            ticklabel style={font=\tiny},
            width=0.3cm
        },
        enlargelimits=false,
        axis on top,
    },
    % --- Specific plot types ---
    dsm plot/.style={
        publication,
        cycle list name=conceptcolors,
        xlabel={Time},
        ylabel={Density},
        legend pos=north east,
        domain=0:15,
    },
    mensa plot/.style={
        publication,
        cycle list name=conceptcolors,
        xlabel={Time},
        ylabel={Cumulative Incidence},
        ymin=0,
        ymax=1,
        legend pos=north west,
    },
    loss comparison/.style={
        publication grid,
        xlabel={Epoch},
        ylabel={Loss Value},
        legend pos=north east,
    },
    risk stratification/.style={
        publication,
        xlabel={Time},
        ylabel={Survival Probability},
        ymin=0,
        ymax=1,
        legend style={
            at={(0.02,0.02)},
            anchor=south west,
        },
    },
    % --- Styling for specific content types ---
    % Renamed to avoid recursion issues with built-in styles
    error bars/.style={
        error bars/y dir=both,
        error bars/y explicit,
        error bars/error mark=|,
        error bars/error bar style={line width=0.8pt},
    },
    custom no markers/.style={
        mark=none,
    },
    custom dashed/.style={
        dashed,
        line width=0.8pt,
    },
    custom dotted/.style={
        dotted,
        line width=0.8pt,
    },
    custom ultra thick/.style={
        line width=1.5pt,
    },
    % --- Legend positioning variants ---
    legend northwest/.style={
        legend style={at={(0.02,0.98)}, anchor=north west}
    },
    legend northeast/.style={
        legend style={at={(0.98,0.98)}, anchor=north east}
    },
    legend southwest/.style={
        legend style={at={(0.02,0.02)}, anchor=south west}
    },
    legend southeast/.style={
        legend style={at={(0.98,0.02)}, anchor=south east}
    },
    legend north/.style={
        legend style={at={(0.5,0.98)}, anchor=north}
    },
    legend south/.style={
        legend style={at={(0.5,0.02)}, anchor=south}
    },
    % --- Color fill between options ---
    confidence band/.style={
        fill=primary!20,
        draw=none,
        opacity=0.5
    },
    confidence band secondary/.style={
        fill=secondary!20,
        draw=none,
        opacity=0.5
    },
    confidence band tertiary/.style={
        fill=tertiary!20,
        draw=none,
        opacity=0.5
    },
    confidence band quaternary/.style={
        fill=quaternary!20,
        draw=none,
        opacity=0.5
    },
}

% --- Define specific colors for different plot elements ---
\pgfplotscreateplotcyclelist{publishcolors}{
    {primary, mark=o, thick, mark options={fill=primary, solid}},
    {secondary, mark=square, thick, mark options={fill=secondary, solid}},
    {tertiary, mark=triangle, thick, mark options={fill=tertiary, solid}},
    {quaternary, mark=diamond, thick, mark options={fill=quaternary, solid}},
    {quinary, mark=pentagon, thick, mark options={fill=quinary, solid}},
    {senary, mark=*, thick, mark options={fill=senary, solid}},
    {septenary, mark=Mercedes star, thick, mark options={fill=septenary, solid}},
    {octonary, mark=otimes*, thick, mark options={fill=octonary, solid}},
    {nonary, mark=star, thick, mark options={fill=nonary, solid}},
    {denary, mark=10-pointed star, thick, mark options={fill=denary, solid}}
}

% --- Define consistent styles for special plot types ---
\pgfplotscreateplotcyclelist{custom dashedcolors}{
    {primary, mark=none, thick, dashed},
    {secondary, mark=none, thick, dashed},
    {tertiary, mark=none, thick, dashed},
    {quaternary, mark=none, thick, dashed},
    {quinary, mark=none, thick, dashed},
    {senary, mark=none, thick, dashed},
    {septenary, mark=none, thick, dashed},
    {octonary, mark=none, thick, dashed},
    {nonary, mark=none, thick, dashed},
    {denary, mark=none, thick, dashed}
}

\pgfplotscreateplotcyclelist{custom dottedcolors}{
    {primary, mark=none, thick, dotted},
    {secondary, mark=none, thick, dotted},
    {tertiary, mark=none, thick, dotted},
    {quaternary, mark=none, thick, dotted},
    {quinary, mark=none, thick, dotted},
    {senary, mark=none, thick, dotted},
    {septenary, mark=none, thick, dotted},
    {octonary, mark=none, thick, dotted},
    {nonary, mark=none, thick, dotted},
    {denary, mark=none, thick, dotted}
}

% --- Color maps for heatmaps ---
\pgfplotsset{
    colormap={bluewhitered}{
        rgb255=(0,0,255)
        rgb255=(255,255,255)
        rgb255=(255,0,0)
    },
    colormap={spectral}{
        rgb255=(158,1,66)
        rgb255=(213,62,79)
        rgb255=(244,109,67)
        rgb255=(253,174,97)
        rgb255=(254,224,139)
        rgb255=(255,255,191)
        rgb255=(230,245,152)
        rgb255=(171,221,164)
        rgb255=(102,194,165)
        rgb255=(50,136,189)
        rgb255=(94,79,162)
    },
    colormap={viridis}{
        rgb255=(68,1,84)
        rgb255=(72,40,120)
        rgb255=(62,83,139)
        rgb255=(49,104,142)
        rgb255=(38,130,142)
        rgb255=(31,158,137)
        rgb255=(53,183,121)
        rgb255=(109,205,89)
        rgb255=(180,222,44)
        rgb255=(253,231,37)
    }
}

% ===================================
% USAGE EXAMPLES
% ===================================
%
% Basic usage:
% \begin{tikzpicture}
%   \begin{axis}[publication]
%     \addplot coordinates {(0,0) (1,1) (2,4)};
%   \end{axis}
% \end{tikzpicture}
%
% Survival curve with confidence bands:
% \begin{tikzpicture}
%   \begin{axis}[survival plot, cycle list name=publishcolors]
%     \addplot coordinates {(0,1) (1,0.9) (2,0.8) (3,0.7)};
%     \addplot[name path=upper, custom dashed] coordinates {(0,1) (1,0.95) (2,0.85) (3,0.75)};
%     \addplot[name path=lower, custom dashed] coordinates {(0,1) (1,0.85) (2,0.75) (3,0.65)};
%     \addplot[confidence band] fill between[of=upper and lower];
%     \legend{Survival, Upper 95\% CI, Lower 95\% CI}
%   \end{axis}
% \end{tikzpicture}
%
% Competing risks (MENSA):
% \begin{tikzpicture}
%   \begin{axis}[mensa plot]
%     \addplot[event1Color, thick] coordinates {(0,0) (1,0.1) (2,0.2) (3,0.3)};
%     \addplot[event2Color, thick] coordinates {(0,0) (1,0.05) (2,0.1) (3,0.15)};
%     \addplot[event3Color, thick] coordinates {(0,0) (1,0.03) (2,0.07) (3,0.12)};
%     \legend{Event 1, Event 2, Event 3}
%   \end{axis}
% \end{tikzpicture}
%
% Risk stratification:
% \begin{tikzpicture}
%   \begin{axis}[risk stratification]
%     \addplot[lowRiskColor, thick] coordinates {(0,1) (1,0.95) (2,0.9) (3,0.85)};
%     \addplot[mediumRiskColor, thick] coordinates {(0,1) (1,0.8) (2,0.7) (3,0.6)};
%     \addplot[highRiskColor, thick] coordinates {(0,1) (1,0.6) (2,0.4) (3,0.2)};
%     \legend{Low Risk, Medium Risk, High Risk}
%   \end{axis}
% \end{tikzpicture}
%
% Loss function comparison:
% \begin{tikzpicture}
%   \begin{axis}[loss comparison]
%     \addplot[likelihoodLossColor, thick] coordinates {(0,2) (10,1.5) (20,1.2) (30,1)};
%     \addplot[rankingLossColor, thick] coordinates {(0,2.2) (10,1.6) (20,1.3) (30,1.1)};
%     \legend{Likelihood Loss, Ranking Loss}
%   \end{axis}
% \end{tikzpicture}
%
% Density plots (DSM):
% \begin{tikzpicture}
%   \begin{axis}[dsm plot]
%     \addplot[domain=0:15, samples=100] {0.5*exp(-(x-3)^2/4)};
%     \addplot[domain=0:15, samples=100] {0.3*exp(-(x-7)^2/3)};
%     \addplot[domain=0:15, samples=100] {0.2*exp(-(x-10)^2/5)};
%     \addplot[black, thick, domain=0:15, samples=100] {0.5*exp(-(x-3)^2/4) + 0.3*exp(-(x-7)^2/3) + 0.2*exp(-(x-10)^2/5)};
%     \legend{Component 1, Component 2, Component 3, Mixture}
%   \end{axis}
% \end{tikzpicture}
%
