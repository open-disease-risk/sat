_target_: sat.data.dataset.parse_meds.meds
source: ${data_source}
processed_dir: ${modelhub}
train_ratio: 0.7
validation_ratio: 0.15
test_ratio: 0.15
n_bins: 20
encode: ordinal
strategy: quantile
name: ${dataset}
kfold: ${cv.kfold}
time_field: days
# Scaling options for numerical features
scale_numerics: true
scale_method: "standard"  # or "min_max"
min_scale_numerics: 1.0  # Used with min_max scaling

# Custom labelers using parallel processing
labelers:
  # Mortality labeler to identify death events
  - type: mortality
    name: death_labeler
    max_followup_days: 1095  # 3 years follow-up
    # MEDS_DEATH_CODE is "SNOMED/419620001" from meds.schema
    enrollment_codes: ["ENROLLMENT"]

  # Competing risks labeler for multiple events
  - type: competing_risk
    name: competing_risks_labeler
    max_followup_days: 1095
    event_codes:
      # death: Using MEDS_DEATH_CODE ("SNOMED/419620001") from the schema
      hospitalization: ["ENC_INPATIENT"]
    enrollment_codes: ["ENROLLMENT"]

  # Custom event labeler for diabetes complications
  - type: custom_event
    name: diabetes_complications
    max_followup_days: 1095
    event_definition:
      and:
        - codes: ["ICD10:E11"]  # Type 2 diabetes
        - or:
            - codes: ["ICD10:I50"]  # Heart failure
            - codes: ["ICD10:N18"]  # Kidney disease
    enrollment_codes: ["ENROLLMENT"]

  # Risk factor labeler to identify conditions
  - type: risk_factor
    name: risk_factor_labeler
    custom_codes:
      icd10:
        hypertension: ["I15.9"]
        diabetes: ["E11"]
        heart_failure: ["I50"]
      rxnorm:
        diabetes: ["A10"]

# Backwards compatibility for existing code
label_definitions:
  - name: mortality
    positive_class: true
    table_name: mortality
    time_field: days
  - name: hospitalization
    positive_class: true
    table_name: hospitalizations
    time_field: days
