task: optuna_sweep
optuna:
  study_overwrite: true
  metric: test_ipcw_avg
job: job
seed: null
modelname: survival
dataset: metabric
log_dir: ${base_dir}/logs
data:
  num_events: 1
  label_transform:
    cuts: ${label_transform_cuts}
    save_dir: ${modelhub}/${dataset}
    buffer_size: 20000
    scheme: ${label_transform_scheme}
    event_type: null
  id_col: id
  event_col: event
  duration_col: duration
  cache_dir: data/cache
learning_rate: 0.0001
weight_decay: 0.01
transformer_hidden_size: 16
transformer_intermediate_size: 64
transformer_num_attention_heads: 2
transformer_num_hidden_layers: 2
survival_intermediate_size: 16
token_emb: 3
sentence_emb: 2
transformer_attention_probs_dropout_prob: 0.1
transformer_hidden_probs_dropout: 0.1
transformer_initializer_range: 0.02
mtl_initializer_range: 0.02
mtl_initializer: normal
shared_intermediate_size: 32
shared_num_labels: 16
shared_batch_norm: false
shared_hidden_dropout_prob: 0.1
shared_bias: true
shared_num_hidden_layers: 1
select_hidden_layers: false
survival_initializer_range: 0.02
survival_initializer: normal
survival_shared_intermediate_size: 24
survival_shared_num_hidden_layers: 1
survival_num_hidden_layers: 1
survival_batch_norm: false
survival_hidden_dropout_prob: 0.1
survival_bias: true
survival_loss_weight: 1.0
transformers: bert
tokenizers:
  max_seq_length: 128
  pad_token: '[PAD]'
  mask_token: '[MASK]'
  tokenizer_dir: data/model-hub/metabric/tokenizer
  cls_model_type: BERT
  tokenize_column: data
  is_split_into_words: true
  do_truncation: true
  padding_args:
    padding: max_length
    pad_to_multiple_of: 8
    direction: post
  truncation_args:
    direction: post
do_sweep: false
do_data_parse: true
do_data_transform: true
do_tokenize: true
do_pretrain: false
do_finetune: true
run_id: ${oc.env:AZUREML_RUN_ID, ""}
parent_run_id: ${oc.env:AZUREML_ROOT_RUN_ID, "."}
base_dir: .
model_dir: ${parent_run_id}/${run_id}
data_dir: ${base_dir}/data
output_dir: ${hydra:runtime.output_dir}
work_dir: ${hydra:runtime.cwd}
modelhub: ${data_dir}/model-hub
callbacks:
- _target_: transformers.EarlyStoppingCallback
  early_stopping_patience: 10
task_name: sat-${task}-${modelname}-${dataset}-${job}
cv:
  kfold: ${oc.select:cv_kfold,0}
sweep:
  hydra:
    sweeper:
      sampler:
        seed: ${seed}
        consider_prior: true
        prior_weight: 1.0
        consider_magic_clip: true
        consider_endpoints: false
        n_startup_trials: 10
        n_ei_candidates: 24
        multivariate: false
        warn_independent_sampling: true
      direction: ${optuna.metric}
      storage: sqlite:///data/modelhub/metabric/survival/studies.db
      study_name: metabric_survival
      n_trials: 50
      n_jobs: 1
      max_failure_rate: 0.0
      params:
        learning_rate:
          type: float
          low: 1.0e-05
          high: 0.01
          log: true
        weight_decay:
          type: float
          low: 1.0e-05
          high: 0.1
          log: true
        transformer_hidden_size:
          type: categorical
          choices:
          - 8
          - 16
          - 32
        transformer_intermediate_size:
          type: categorical
          choices:
          - 32
          - 64
          - 96
        transformer_num_attention_heads:
          type: categorical
          choices:
          - 2
          - 4
        transformer_num_hidden_layers:
          type: categorical
          choices:
          - 1
          - 2
          - 4
        survival_intermediate_size:
          type: categorical
          choices:
          - 8
          - 16
          - 24
        token_emb:
          type: categorical
          choices:
          - 2
          - 3
          - 4
          - 5
        sentence_emb:
          type: categorical
          choices:
          - 1
          - 2
          - 3
  optuna:
    study_overwrite: true
    metric: test_ipcw_avg
    metric_direction: maximize
    pruner:
      _target_: optuna.pruners.MedianPruner
      n_startup_trials: 5
      n_warmup_steps: 20
      interval_steps: 5
