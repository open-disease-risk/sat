task: optuna_sweep
optuna:
  study_overwrite: true
  metric: test_ipcw_avg
job: job
seed: null
modelname: survival
dataset: metabric
log_dir: ${base_dir}/logs
learning_rate: 0.0001
weight_decay: 0.01
transformer_hidden_size: 32
transformer_intermediate_size: 64
transformer_num_attention_heads: 2
transformer_num_hidden_layers: 2
survival_intermediate_size: 16
token_emb: 3
sentence_emb: 2
do_sweep: false
do_data_parse: true
do_data_transform: true
do_tokenize: true
do_pretrain: false
do_finetune: true
run_id: ${oc.env:AZUREML_RUN_ID, ""}
parent_run_id: ${oc.env:AZUREML_ROOT_RUN_ID, "."}
base_dir: .
model_dir: ${parent_run_id}/${run_id}
data_dir: ${base_dir}/data
output_dir: ${hydra:runtime.output_dir}
work_dir: ${hydra:runtime.cwd}
modelhub: ${data_dir}/model-hub
data:
  label_transform:
    buffer_size: 20000
    cuts: ${label_transform_cuts}
    scheme: ${label_transform_scheme}
    save_dir: ${modelhub}/${dataset}
    event_type: null
callbacks:
- _target_: transformers.EarlyStoppingCallback
  early_stopping_patience: 10
task_name: sat-${task}-${modelname}-${dataset}-${job}
cv:
  kfold: ${oc.select:cv_kfold,0}
sweep:
  hydra:
    sweeper:
      sampler:
        seed: ${seed}
        consider_prior: true
        prior_weight: 1.0
        consider_magic_clip: true
        consider_endpoints: false
        n_startup_trials: 10
        n_ei_candidates: 24
        multivariate: false
        warn_independent_sampling: true
      direction: ${optuna.metric}
      storage: sqlite:///data/modelhub/metabric/survival/studies.db
      study_name: metabric_survival
      n_trials: 50
      n_jobs: 1
      max_failure_rate: 0.0
      params:
        learning_rate:
          type: float
          low: 1.0e-05
          high: 0.01
          log: true
        weight_decay:
          type: float
          low: 1.0e-05
          high: 0.1
          log: true
        transformer_hidden_size:
          type: categorical
          choices:
          - 8
          - 16
          - 32
        transformer_intermediate_size:
          type: categorical
          choices:
          - 32
          - 64
          - 96
        transformer_num_attention_heads:
          type: categorical
          choices:
          - 2
          - 4
        transformer_num_hidden_layers:
          type: categorical
          choices:
          - 1
          - 2
          - 4
        survival_intermediate_size:
          type: categorical
          choices:
          - 8
          - 16
          - 24
        token_emb:
          type: categorical
          choices:
          - 2
          - 3
          - 4
          - 5
        sentence_emb:
          type: categorical
          choices:
          - 1
          - 2
          - 3
  optuna:
    study_overwrite: true
    metric: test_ipcw_avg
    metric_direction: maximize
    pruner:
      _target_: optuna.pruners.MedianPruner
      n_startup_trials: 5
      n_warmup_steps: 20
      interval_steps: 5
